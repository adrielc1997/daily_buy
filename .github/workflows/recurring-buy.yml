name: Recurring Crypto Spot Buy

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: [self-hosted, okx-static-ip]

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Set up virtual environment
      run: |
        python3 -m venv .venv
        source .venv/bin/activate
        
    - name: Install dependencies
      run: |
        source .venv/bin/activate
        pip install requests
        
    - name: Run Python script
      env:
        OKX_API_KEY: ${{ secrets.OKX_API_KEY }}
        OKX_SECRET_KEY: ${{ secrets.OKX_SECRET_KEY }}
        OKX_PASSPHRASE: ${{ secrets.OKX_PASSPHRASE }}
        OKX_BUY_AMOUNT_SGD: ${{ secrets.OKX_BUY_AMOUNT_SGD }}
        OKX_CCY_CRYPTO_ASSET: ${{ secrets.OKX_CCY_CRYPTO_ASSET }} 
        OKX_INST_ID_CRYPTO_USDT: ${{ secrets.OKX_INST_ID_CRYPTO_USDT }}
      run: |
        source .venv/bin/activate
        python3 buy.py
